image: node:6.10.0
pipelines:
  default:
    - step:
        script:
          # installing dependencies
          - export PATH=./node_modules/.bin:$PATH
          - npm i -q

          # initial setup
          - snyk auth ${SNYK_TOKEN} -d
          - snyk protect

          # running tests
          - npm test

          # monitor for new vulnerabilities
          - if [ $BITBUCKET_BRANCH == "master" ]; then snyk monitor; fi;